<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo S·ª≠a L·ªói S·ªë Nh√† - Garage Registration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .demo-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto;
        }
        .demo-title {
            color: #333;
            margin-bottom: 30px;
            font-size: 28px;
            font-weight: bold;
            text-align: center;
        }
        .demo-button {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .demo-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }
        .demo-button.success {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        .demo-button.success:hover {
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }
        .demo-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            background: #f9fafb;
        }
        .demo-section h3 {
            color: #374151;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 600;
        }
        .demo-description {
            color: #6b7280;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        .address-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        .address-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .status-message {
            margin-top: 8px;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .status-success {
            background: #ecfdf5;
            color: #059669;
            border: 1px solid #a7f3d0;
        }
        .status-loading {
            background: #eff6ff;
            color: #2563eb;
            border: 1px solid #93c5fd;
        }
        .test-case {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .test-case h4 {
            color: #374151;
            margin-bottom: 10px;
            font-size: 16px;
            font-weight: 600;
        }
        .before-after {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }
        .before, .after {
            padding: 10px;
            border-radius: 6px;
        }
        .before {
            background: #fef2f2;
            border: 1px solid #fca5a5;
        }
        .after {
            background: #ecfdf5;
            border: 1px solid #a7f3d0;
        }
        .before h5, .after h5 {
            font-weight: 600;
            margin-bottom: 5px;
        }
        .before h5 {
            color: #dc2626;
        }
        .after h5 {
            color: #059669;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <h1 class="demo-title">üè† Demo S·ª≠a L·ªói S·ªë Nh√†</h1>
        
        <div class="demo-description">
            Demo t√≠nh nƒÉng ƒë√£ s·ª≠a ƒë·ªÉ gi·ªØ l·∫°i s·ªë nh√† c·ªßa ng∆∞·ªùi d√πng khi auto-fill ƒë·ªãa ch·ªâ.
            <strong>V·∫•n ƒë·ªÅ tr∆∞·ªõc ƒë√¢y:</strong> S·ªë nh√† b·ªã x√≥a khi geocoding t√¨m th·∫•y ƒë·ªãa ch·ªâ ƒë·∫ßy ƒë·ªß.
            <strong>Gi·∫£i ph√°p:</strong> Merge s·ªë nh√† c·ªßa user v·ªõi ƒë·ªãa ch·ªâ ƒë·∫ßy ƒë·ªß t·ª´ geocoding.
        </div>

        <!-- Test Cases -->
        <div class="demo-section">
            <h3>üß™ Test Cases</h3>
            
            <div class="test-case">
                <h4>Test Case 1: "48 B√πi Th·ªã Xu√¢n"</h4>
                <div class="before-after">
                    <div class="before">
                        <h5>‚ùå Tr∆∞·ªõc (L·ªói):</h5>
                        <p><strong>Input:</strong> 48 B√πi Th·ªã Xu√¢n</p>
                        <p><strong>Output:</strong> B√πi Th·ªã Xu√¢n, Khu ph·ªë 3, Ph∆∞·ªùng B·∫øn Th√†nh, Th·ªß ƒê·ª©c, Ho Chi Minh City, 70200, Vietnam</p>
                        <p><em>S·ªë nh√† "48" b·ªã m·∫•t!</em></p>
                    </div>
                    <div class="after">
                        <h5>‚úÖ Sau (ƒê√£ s·ª≠a):</h5>
                        <p><strong>Input:</strong> 48 B√πi Th·ªã Xu√¢n</p>
                        <p><strong>Output:</strong> 48 B√πi Th·ªã Xu√¢n, Khu ph·ªë 3, Ph∆∞·ªùng B·∫øn Th√†nh, Th·ªß ƒê·ª©c, Ho Chi Minh City, 70200, Vietnam</p>
                        <p><em>S·ªë nh√† "48" ƒë∆∞·ª£c gi·ªØ l·∫°i!</em></p>
                    </div>
                </div>
            </div>

            <div class="test-case">
                <h4>Test Case 2: "123 Nguy·ªÖn Hu·ªá"</h4>
                <div class="before-after">
                    <div class="before">
                        <h5>‚ùå Tr∆∞·ªõc (L·ªói):</h5>
                        <p><strong>Input:</strong> 123 Nguy·ªÖn Hu·ªá</p>
                        <p><strong>Output:</strong> Nguy·ªÖn Hu·ªá, B·∫øn Ngh√©, Qu·∫≠n 1, Ho Chi Minh City, 700000, Vietnam</p>
                        <p><em>S·ªë nh√† "123" b·ªã m·∫•t!</em></p>
                    </div>
                    <div class="after">
                        <h5>‚úÖ Sau (ƒê√£ s·ª≠a):</h5>
                        <p><strong>Input:</strong> 123 Nguy·ªÖn Hu·ªá</p>
                        <p><strong>Output:</strong> 123 Nguy·ªÖn Hu·ªá, B·∫øn Ngh√©, Qu·∫≠n 1, Ho Chi Minh City, 700000, Vietnam</p>
                        <p><em>S·ªë nh√† "123" ƒë∆∞·ª£c gi·ªØ l·∫°i!</em></p>
                    </div>
                </div>
            </div>

            <div class="test-case">
                <h4>Test Case 3: "456A L√™ L·ª£i"</h4>
                <div class="before-after">
                    <div class="before">
                        <h5>‚ùå Tr∆∞·ªõc (L·ªói):</h5>
                        <p><strong>Input:</strong> 456A L√™ L·ª£i</p>
                        <p><strong>Output:</strong> L√™ L·ª£i, B·∫øn Ngh√©, Qu·∫≠n 1, Ho Chi Minh City, 700000, Vietnam</p>
                        <p><em>S·ªë nh√† "456A" b·ªã m·∫•t!</em></p>
                    </div>
                    <div class="after">
                        <h5>‚úÖ Sau (ƒê√£ s·ª≠a):</h5>
                        <p><strong>Input:</strong> 456A L√™ L·ª£i</p>
                        <p><strong>Output:</strong> 456A L√™ L·ª£i, B·∫øn Ngh√©, Qu·∫≠n 1, Ho Chi Minh City, 700000, Vietnam</p>
                        <p><em>S·ªë nh√† "456A" ƒë∆∞·ª£c gi·ªØ l·∫°i!</em></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Interactive Demo -->
        <div class="demo-section">
            <h3>üéÆ Demo T∆∞∆°ng T√°c</h3>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">
                    ƒê·ªãa ch·ªâ *
                </label>
                <input 
                    type="text" 
                    id="addressInput"
                    class="address-input" 
                    placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ c√≥ s·ªë nh√† (v√≠ d·ª•: 48 B√πi Th·ªã Xu√¢n)"
                    value=""
                />
                
                <div id="statusMessage" style="display: none;"></div>
            </div>
            
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="demo-button" onclick="testHouseNumber('48 B√πi Th·ªã Xu√¢n')">
                    üè† Test 48 B√πi Th·ªã Xu√¢n
                </button>
                
                <button class="demo-button" onclick="testHouseNumber('123 Nguy·ªÖn Hu·ªá')">
                    üè† Test 123 Nguy·ªÖn Hu·ªá
                </button>
                
                <button class="demo-button" onclick="testHouseNumber('456A L√™ L·ª£i')">
                    üè† Test 456A L√™ L·ª£i
                </button>
                
                <button class="demo-button success" onclick="resetDemo()">
                    üîÑ Reset
                </button>
            </div>
        </div>

        <!-- Logic Explanation -->
        <div class="demo-section">
            <h3>üí° Logic ƒê√£ S·ª≠a</h3>
            <div class="demo-description">
                <h4>üîß H√†m mergeAddressWithHouseNumber:</h4>
                <ol style="list-style: decimal; margin-left: 20px; color: #6b7280;">
                    <li><strong>Ph√°t hi·ªán s·ªë nh√†:</strong> S·ª≠ d·ª•ng regex <code>/^(\d+[a-zA-Z]?)\s*(.+)/</code> ƒë·ªÉ t√¨m s·ªë nh√† ·ªü ƒë·∫ßu chu·ªói</li>
                    <li><strong>T√°ch th√†nh ph·∫ßn:</strong> T√°ch s·ªë nh√† v√† t√™n ƒë∆∞·ªùng t·ª´ input c·ªßa user</li>
                    <li><strong>Ki·ªÉm tra match:</strong> Ki·ªÉm tra xem geocoding result c√≥ ch·ª©a t√™n ƒë∆∞·ªùng kh√¥ng</li>
                    <li><strong>Merge th√¥ng minh:</strong> 
                        <ul style="margin-left: 20px;">
                            <li>N·∫øu match: Thay th·∫ø s·ªë nh√† trong geocoding result</li>
                            <li>N·∫øu kh√¥ng match: Th√™m s·ªë nh√† v√†o ƒë·∫ßu geocoding result</li>
                        </ul>
                    </li>
                </ol>
                
                <h4>üîÑ C·∫£i ti·∫øn useEffect:</h4>
                <ul style="list-style: disc; margin-left: 20px; color: #6b7280;">
                    <li>S·ª≠ d·ª•ng <code>lastAddressInput.current</code> ƒë·ªÉ l·∫•y ƒë·ªãa ch·ªâ g·ªëc c·ªßa user</li>
                    <li>Tr√°nh s·ª≠ d·ª•ng <code>address</code> state ƒë√£ b·ªã c·∫≠p nh·∫≠t</li>
                    <li>Th√™m console.log ƒë·ªÉ debug v√† theo d√µi</li>
                </ul>
            </div>
        </div>

        <!-- Code Example -->
        <div class="demo-section">
            <h3>üíª Code Example</h3>
            <div style="background: #1f2937; color: #f9fafb; padding: 20px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 14px; overflow-x: auto;">
<pre>// H√†m merge s·ªë nh√† v·ªõi ƒë·ªãa ch·ªâ ƒë·∫ßy ƒë·ªß
const mergeAddressWithHouseNumber = (userInput, geocodingResult) => {
  const houseNumberMatch = userInput.match(/^(\d+[a-zA-Z]?)\s*(.+)/)
  
  if (houseNumberMatch) {
    const houseNumber = houseNumberMatch[1] // S·ªë nh√†
    const streetName = houseNumberMatch[2].trim() // T√™n ƒë∆∞·ªùng
    
    if (geocodingResult.toLowerCase().includes(streetName.toLowerCase())) {
      // Thay th·∫ø s·ªë nh√† trong geocoding result
      return geocodingResult.replace(/^\d+[a-zA-Z]?\s*/, `${houseNumber} `)
    } else {
      // Th√™m s·ªë nh√† v√†o ƒë·∫ßu geocoding result
      return `${houseNumber} ${geocodingResult}`
    }
  }
  
  return geocodingResult
}

// S·ª≠ d·ª•ng trong useEffect
const originalUserInput = lastAddressInput.current.trim()
const mergedAddress = mergeAddressWithHouseNumber(originalUserInput, geocodingResult.display_name)
setAddress(mergedAddress)</pre>
            </div>
        </div>
    </div>

    <script>
        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.className = `status-message status-${type}`;
            statusDiv.innerHTML = message;
            statusDiv.style.display = 'block';
        }

        function hideStatus() {
            document.getElementById('statusMessage').style.display = 'none';
        }

        function mergeAddressWithHouseNumber(userInput, geocodingResult) {
            console.log('Merging addresses:', { userInput, geocodingResult });
            
            const houseNumberMatch = userInput.match(/^(\d+[a-zA-Z]?)\s*(.+)/);
            
            if (houseNumberMatch) {
                const houseNumber = houseNumberMatch[1];
                const streetName = houseNumberMatch[2].trim();
                
                console.log('Found house number:', houseNumber, 'Street name:', streetName);
                
                if (geocodingResult.toLowerCase().includes(streetName.toLowerCase())) {
                    const mergedAddress = geocodingResult.replace(/^\d+[a-zA-Z]?\s*/, `${houseNumber} `);
                    console.log('Merged address:', mergedAddress);
                    return mergedAddress;
                } else {
                    const mergedAddress = `${houseNumber} ${geocodingResult}`;
                    console.log('Added house number to geocoding result:', mergedAddress);
                    return mergedAddress;
                }
            }
            
            console.log('No house number found, using geocoding result');
            return geocodingResult;
        }

        function testHouseNumber(address) {
            const input = document.getElementById('addressInput');
            input.value = address;
            
            // Simulate geocoding result
            const mockGeocodingResult = {
                display_name: "B√πi Th·ªã Xu√¢n, Khu ph·ªë 3, Ph∆∞·ªùng B·∫øn Th√†nh, Th·ªß ƒê·ª©c, Ho Chi Minh City, 70200, Vietnam"
            };
            
            // Apply the fix
            const mergedAddress = mergeAddressWithHouseNumber(address, mockGeocodingResult.display_name);
            
            // Update input with merged result
            input.value = mergedAddress;
            
            // Show success message
            showStatus(`‚úÖ ƒê√£ t√¨m th·∫•y v√† t·ª± ƒë·ªông c·∫≠p nh·∫≠t (gi·ªØ s·ªë nh√†): ${mergedAddress}`, 'success');
            
            console.log('Test completed:', { original: address, result: mergedAddress });
        }

        function resetDemo() {
            document.getElementById('addressInput').value = '';
            hideStatus();
        }

        // Auto demo
        setTimeout(() => {
            console.log('üöÄ Auto demo house number preservation...');
            testHouseNumber('48 B√πi Th·ªã Xu√¢n');
        }, 2000);

        // Initialize Lucide icons
        lucide.createIcons();
    </script>
</body>
</html>
