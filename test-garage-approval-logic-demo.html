<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo Logic Ph√™ Duy·ªát Garage M·ªõi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .demo-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 1000px;
            margin: 0 auto;
        }
        .demo-title {
            color: #333;
            margin-bottom: 30px;
            font-size: 28px;
            font-weight: bold;
            text-align: center;
        }
        .demo-button {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .demo-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }
        .demo-button.success {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        .demo-button.success:hover {
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }
        .demo-button.warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }
        .demo-button.warning:hover {
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
        }
        .demo-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            background: #f9fafb;
        }
        .demo-section h3 {
            color: #374151;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 600;
        }
        .demo-description {
            color: #6b7280;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        .test-case {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .test-case h4 {
            color: #374151;
            margin-bottom: 10px;
            font-size: 16px;
            font-weight: 600;
        }
        .before-after {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }
        .before, .after {
            padding: 10px;
            border-radius: 6px;
        }
        .before {
            background: #fef2f2;
            border: 1px solid #fca5a5;
        }
        .after {
            background: #ecfdf5;
            border: 1px solid #a7f3d0;
        }
        .before h5, .after h5 {
            font-weight: 600;
            margin-bottom: 5px;
        }
        .before h5 {
            color: #dc2626;
        }
        .after h5 {
            color: #059669;
        }
        .step-flow {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        .step-number {
            background: #3b82f6;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        .step-content {
            flex: 1;
        }
        .step-title {
            font-weight: 600;
            color: #374151;
            margin-bottom: 5px;
        }
        .step-description {
            color: #6b7280;
            font-size: 14px;
        }
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        .status-immediate {
            background: #ecfdf5;
            color: #059669;
            border: 1px solid #a7f3d0;
        }
        .status-approval {
            background: #fffbeb;
            color: #d97706;
            border: 1px solid #fed7aa;
        }
        .form-section {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        .form-section h4 {
            color: #374151;
            margin-bottom: 15px;
            font-size: 16px;
            font-weight: 600;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #374151;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .checkbox-item:hover {
            background: #f9fafb;
        }
        .checkbox-item.selected {
            background: #eff6ff;
            border-color: #3b82f6;
        }
        .checkbox-item input[type="checkbox"] {
            width: auto;
        }
        .result-message {
            margin-top: 15px;
            padding: 12px;
            border-radius: 6px;
            font-weight: 500;
        }
        .result-immediate {
            background: #ecfdf5;
            color: #059669;
            border: 1px solid #a7f3d0;
        }
        .result-approval {
            background: #fffbeb;
            color: #d97706;
            border: 1px solid #fed7aa;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <h1 class="demo-title">üîß Demo Logic Ph√™ Duy·ªát Garage M·ªõi</h1>
        
        <div class="demo-description">
            Demo logic m·ªõi ƒë·ªÉ ph√¢n bi·ªát c√°c lo·∫°i thay ƒë·ªïi garage:
            <strong>Kh√¥ng c·∫ßn ph√™ duy·ªát:</strong> D·ªãch v·ª•, lo·∫°i xe, gi·ªù l√†m vi·ªác
            <strong>C·∫ßn ph√™ duy·ªát:</strong> Th√¥ng tin garage, h√¨nh ·∫£nh
        </div>

        <!-- Logic Overview -->
        <div class="demo-section">
            <h3>üéØ Logic M·ªõi</h3>
            
            <div class="step-flow">
                <div class="step-number">1</div>
                <div class="step-content">
                    <div class="step-title">Ph√¢n t√≠ch thay ƒë·ªïi</div>
                    <div class="step-description">Backend ph√¢n t√≠ch lo·∫°i thay ƒë·ªïi t·ª´ user</div>
                </div>
            </div>
            
            <div class="step-flow">
                <div class="step-number">2</div>
                <div class="step-content">
                    <div class="step-title">Quy·∫øt ƒë·ªãnh ph√™ duy·ªát</div>
                    <div class="step-description">
                        <span class="status-badge status-immediate">C·∫≠p nh·∫≠t ngay</span> ho·∫∑c 
                        <span class="status-badge status-approval">C·∫ßn ph√™ duy·ªát</span>
                    </div>
                </div>
            </div>
            
            <div class="step-flow">
                <div class="step-number">3</div>
                <div class="step-content">
                    <div class="step-title">Tr·∫£ v·ªÅ response</div>
                    <div class="step-description">Frontend nh·∫≠n th√¥ng tin v·ªÅ lo·∫°i c·∫≠p nh·∫≠t</div>
                </div>
            </div>
            
            <div class="step-flow">
                <div class="step-number">4</div>
                <div class="step-content">
                    <div class="step-title">Hi·ªÉn th·ªã th√¥ng b√°o</div>
                    <div class="step-description">User nh·∫≠n th√¥ng b√°o ph√π h·ª£p v·ªõi lo·∫°i c·∫≠p nh·∫≠t</div>
                </div>
            </div>
        </div>

        <!-- Test Cases -->
        <div class="demo-section">
            <h3>üß™ Test Cases</h3>
            
            <div class="test-case">
                <h4>Test Case 1: Ch·ªâ c·∫≠p nh·∫≠t d·ªãch v·ª•</h4>
                <div class="before-after">
                    <div class="before">
                        <h5>‚ùå Tr∆∞·ªõc (L·ªói):</h5>
                        <p><strong>Thay ƒë·ªïi:</strong> Th√™m "S·ª≠a phanh"</p>
                        <p><strong>K·∫øt qu·∫£:</strong> G·ª≠i ƒë∆°n ph√™ duy·ªát ‚Üí Admin kh√¥ng th·∫•y n√∫t</p>
                        <p><em>Kh√¥ng c·∫ßn ph√™ duy·ªát nh∆∞ng v·∫´n g·ª≠i ƒë∆°n!</em></p>
                    </div>
                    <div class="after">
                        <h5>‚úÖ Sau (ƒê√£ s·ª≠a):</h5>
                        <p><strong>Thay ƒë·ªïi:</strong> Th√™m "S·ª≠a phanh"</p>
                        <p><strong>K·∫øt qu·∫£:</strong> C·∫≠p nh·∫≠t ngay l·∫≠p t·ª©c</p>
                        <p><em>Kh√¥ng g·ª≠i ƒë∆°n ph√™ duy·ªát!</em></p>
                    </div>
                </div>
            </div>

            <div class="test-case">
                <h4>Test Case 2: C·∫≠p nh·∫≠t th√¥ng tin garage + d·ªãch v·ª•</h4>
                <div class="before-after">
                    <div class="before">
                        <h5>‚ùå Tr∆∞·ªõc (L·ªói):</h5>
                        <p><strong>Thay ƒë·ªïi:</strong> T√™n garage + Th√™m d·ªãch v·ª•</p>
                        <p><strong>K·∫øt qu·∫£:</strong> G·ª≠i ƒë∆°n ph√™ duy·ªát ‚Üí Admin th·∫•y n√∫t</p>
                        <p><em>ƒê√∫ng logic, c·∫ßn ph√™ duy·ªát</em></p>
                    </div>
                    <div class="after">
                        <h5>‚úÖ Sau (Gi·ªØ nguy√™n):</h5>
                        <p><strong>Thay ƒë·ªïi:</strong> T√™n garage + Th√™m d·ªãch v·ª•</p>
                        <p><strong>K·∫øt qu·∫£:</strong> G·ª≠i ƒë∆°n ph√™ duy·ªát ‚Üí Admin th·∫•y n√∫t</p>
                        <p><em>V·∫´n ƒë√∫ng logic, c·∫ßn ph√™ duy·ªát</em></p>
                    </div>
                </div>
            </div>

            <div class="test-case">
                <h4>Test Case 3: Ch·ªâ c·∫≠p nh·∫≠t lo·∫°i xe</h4>
                <div class="before-after">
                    <div class="before">
                        <h5>‚ùå Tr∆∞·ªõc (L·ªói):</h5>
                        <p><strong>Thay ƒë·ªïi:</strong> Th√™m "Xe t·∫£i"</p>
                        <p><strong>K·∫øt qu·∫£:</strong> G·ª≠i ƒë∆°n ph√™ duy·ªát ‚Üí Admin kh√¥ng th·∫•y n√∫t</p>
                        <p><em>Kh√¥ng c·∫ßn ph√™ duy·ªát nh∆∞ng v·∫´n g·ª≠i ƒë∆°n!</em></p>
                    </div>
                    <div class="after">
                        <h5>‚úÖ Sau (ƒê√£ s·ª≠a):</h5>
                        <p><strong>Thay ƒë·ªïi:</strong> Th√™m "Xe t·∫£i"</p>
                        <p><strong>K·∫øt qu·∫£:</strong> C·∫≠p nh·∫≠t ngay l·∫≠p t·ª©c</p>
                        <p><em>Kh√¥ng g·ª≠i ƒë∆°n ph√™ duy·ªát!</em></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Interactive Demo -->
        <div class="demo-section">
            <h3>üéÆ Demo T∆∞∆°ng T√°c</h3>
            
            <div class="form-section">
                <h4>Th√¥ng tin Garage</h4>
                <div class="form-group">
                    <label>T√™n garage:</label>
                    <input type="text" id="garageName" value="Garage Th√†nh C√¥ng" />
                </div>
                <div class="form-group">
                    <label>ƒê·ªãa ch·ªâ:</label>
                    <input type="text" id="garageAddress" value="123 L√™ L·ª£i, Q1, TP.HCM" />
                </div>
                <div class="form-group">
                    <label>S·ªë ƒëi·ªán tho·∫°i:</label>
                    <input type="text" id="garagePhone" value="0909123456" />
                </div>
            </div>

            <div class="form-section">
                <h4>D·ªãch v·ª•</h4>
                <div class="checkbox-group">
                    <div class="checkbox-item selected">
                        <input type="checkbox" id="service1" checked />
                        <label for="service1">Thay nh·ªõt</label>
                    </div>
                    <div class="checkbox-item selected">
                        <input type="checkbox" id="service2" checked />
                        <label for="service2">S·ª≠a phanh</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="service3" />
                        <label for="service3">B·∫£o d∆∞·ª°ng</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="service4" />
                        <label for="service4">S·ª≠a ƒë·ªông c∆°</label>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h4>Lo·∫°i xe</h4>
                <div class="checkbox-group">
                    <div class="checkbox-item selected">
                        <input type="checkbox" id="vehicle1" checked />
                        <label for="vehicle1">Xe m√°y</label>
                    </div>
                    <div class="checkbox-item selected">
                        <input type="checkbox" id="vehicle2" checked />
                        <label for="vehicle2">√î t√¥</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="vehicle3" />
                        <label for="vehicle3">Xe t·∫£i</label>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="demo-button" onclick="testUpdate()">
                    üß™ Test C·∫≠p Nh·∫≠t
                </button>
                <button class="demo-button warning" onclick="resetForm()">
                    üîÑ Reset
                </button>
            </div>

            <div id="resultMessage" class="result-message" style="display: none;"></div>
        </div>

        <!-- Backend Logic -->
        <div class="demo-section">
            <h3>üíª Backend Logic</h3>
            <div style="background: #1f2937; color: #f9fafb; padding: 20px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 14px; overflow-x: auto;">
<pre>// Ph√¢n t√≠ch lo·∫°i thay ƒë·ªïi
boolean basicInfoChanged = (nameChanged || phoneChanged || emailChanged || descriptionChanged);
boolean businessInfoChanged = (addressChanged || imageChanged);
boolean servicesChanged = (serviceIdsChanged);
boolean vehicleTypesChanged = (vehicleTypeIdsChanged);
boolean operatingHoursChanged = (operatingHoursChanged);

// Quy·∫øt ƒë·ªãnh c√≥ c·∫ßn ph√™ duy·ªát kh√¥ng
if (basicInfoChanged || businessInfoChanged) {
    needsApproval = true;
}

// N·∫øu ch·ªâ thay ƒë·ªïi d·ªãch v·ª•/lo·∫°i xe/gi·ªù l√†m vi·ªác
if ((servicesChanged || vehicleTypesChanged || operatingHoursChanged) && 
    !basicInfoChanged && !businessInfoChanged) {
    needsApproval = false;
}

// Tr·∫£ v·ªÅ response
if (needsApproval) {
    response.setUpdateType("REQUIRES_APPROVAL");
    response.setUpdateMessage("Thay ƒë·ªïi ƒë√£ ƒë∆∞·ª£c g·ª≠i ch·ªù admin ph√™ duy·ªát");
} else {
    response.setUpdateType("IMMEDIATE_UPDATE");
    response.setUpdateMessage("C·∫≠p nh·∫≠t th√†nh c√¥ng! Thay ƒë·ªïi ƒë√£ ƒë∆∞·ª£c √°p d·ª•ng ngay l·∫≠p t·ª©c");
}</pre>
            </div>
        </div>

        <!-- Frontend Logic -->
        <div class="demo-section">
            <h3>üé® Frontend Logic</h3>
            <div style="background: #1f2937; color: #f9fafb; padding: 20px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 14px; overflow-x: auto;">
<pre>// X·ª≠ l√Ω response t·ª´ backend
const response = await updateGarage(garage.id, updateData);

if (response.updateType === "IMMEDIATE_UPDATE") {
    setSuccess("‚úÖ C·∫≠p nh·∫≠t th√†nh c√¥ng! Thay ƒë·ªïi ƒë√£ ƒë∆∞·ª£c √°p d·ª•ng ngay l·∫≠p t·ª©c.");
} else if (response.updateType === "REQUIRES_APPROVAL") {
    setSuccess("‚è≥ ƒê√£ g·ª≠i y√™u c·∫ßu c·∫≠p nh·∫≠t. Vui l√≤ng ch·ªù admin ph√™ duy·ªát.");
} else {
    setSuccess("C·∫≠p nh·∫≠t th√¥ng tin garage th√†nh c√¥ng!");
}</pre>
            </div>
        </div>
    </div>

    <script>
        function testUpdate() {
            const garageName = document.getElementById('garageName').value;
            const garageAddress = document.getElementById('garageAddress').value;
            const garagePhone = document.getElementById('garagePhone').value;
            
            const services = [];
            if (document.getElementById('service1').checked) services.push('Thay nh·ªõt');
            if (document.getElementById('service2').checked) services.push('S·ª≠a phanh');
            if (document.getElementById('service3').checked) services.push('B·∫£o d∆∞·ª°ng');
            if (document.getElementById('service4').checked) services.push('S·ª≠a ƒë·ªông c∆°');
            
            const vehicles = [];
            if (document.getElementById('vehicle1').checked) vehicles.push('Xe m√°y');
            if (document.getElementById('vehicle2').checked) vehicles.push('√î t√¥');
            if (document.getElementById('vehicle3').checked) vehicles.push('Xe t·∫£i');
            
            // Simulate backend logic
            const originalGarageName = "Garage Th√†nh C√¥ng";
            const originalAddress = "123 L√™ L·ª£i, Q1, TP.HCM";
            const originalPhone = "0909123456";
            const originalServices = ["Thay nh·ªõt", "S·ª≠a phanh"];
            const originalVehicles = ["Xe m√°y", "√î t√¥"];
            
            // Check what changed
            const basicInfoChanged = (garageName !== originalGarageName) || 
                                   (garageAddress !== originalAddress) || 
                                   (garagePhone !== originalPhone);
            
            const servicesChanged = JSON.stringify(services.sort()) !== JSON.stringify(originalServices.sort());
            const vehiclesChanged = JSON.stringify(vehicles.sort()) !== JSON.stringify(originalVehicles.sort());
            
            // Determine approval needed
            let needsApproval = false;
            let updateType = "";
            let message = "";
            
            if (basicInfoChanged) {
                needsApproval = true;
            }
            
            if ((servicesChanged || vehiclesChanged) && !basicInfoChanged) {
                needsApproval = false;
            }
            
            if (needsApproval) {
                updateType = "REQUIRES_APPROVAL";
                message = "‚è≥ ƒê√£ g·ª≠i y√™u c·∫ßu c·∫≠p nh·∫≠t. Vui l√≤ng ch·ªù admin ph√™ duy·ªát.";
            } else {
                updateType = "IMMEDIATE_UPDATE";
                message = "‚úÖ C·∫≠p nh·∫≠t th√†nh c√¥ng! Thay ƒë·ªïi ƒë√£ ƒë∆∞·ª£c √°p d·ª•ng ngay l·∫≠p t·ª©c.";
            }
            
            // Show result
            const resultDiv = document.getElementById('resultMessage');
            resultDiv.className = `result-message ${needsApproval ? 'result-approval' : 'result-immediate'}`;
            resultDiv.innerHTML = `
                <strong>K·∫øt qu·∫£:</strong> ${message}<br>
                <strong>Lo·∫°i c·∫≠p nh·∫≠t:</strong> ${updateType}<br>
                <strong>Thay ƒë·ªïi:</strong> 
                ${basicInfoChanged ? 'Th√¥ng tin garage, ' : ''}
                ${servicesChanged ? 'D·ªãch v·ª•, ' : ''}
                ${vehiclesChanged ? 'Lo·∫°i xe, ' : ''}
                ${!basicInfoChanged && !servicesChanged && !vehiclesChanged ? 'Kh√¥ng c√≥ thay ƒë·ªïi' : ''}
            `;
            resultDiv.style.display = 'block';
            
            console.log('Test Update Result:', {
                basicInfoChanged,
                servicesChanged,
                vehiclesChanged,
                needsApproval,
                updateType,
                message
            });
        }

        function resetForm() {
            document.getElementById('garageName').value = "Garage Th√†nh C√¥ng";
            document.getElementById('garageAddress').value = "123 L√™ L·ª£i, Q1, TP.HCM";
            document.getElementById('garagePhone').value = "0909123456";
            
            document.getElementById('service1').checked = true;
            document.getElementById('service2').checked = true;
            document.getElementById('service3').checked = false;
            document.getElementById('service4').checked = false;
            
            document.getElementById('vehicle1').checked = true;
            document.getElementById('vehicle2').checked = true;
            document.getElementById('vehicle3').checked = false;
            
            document.getElementById('resultMessage').style.display = 'none';
        }

        // Auto demo
        setTimeout(() => {
            console.log('üöÄ Auto demo garage approval logic...');
            testUpdate();
        }, 2000);

        // Initialize Lucide icons
        lucide.createIcons();
    </script>
</body>
</html>
